# TSGen ⚛️  
**Training Set Generator**

[![License](https://img.shields.io/badge/license-MIT-blue.svg)](LICENSE)
[![Python](https://img.shields.io/badge/python-3.10%2B-brightgreen)](https://www.python.org/)
[![Platform](https://img.shields.io/badge/platform-Windows%2010%2F11-lightgrey)]()

TSGen（**Training Set Generator，训练集生成器**）是一个面向计算化学与分子模拟的桌面软件平台，聚焦于：

- **ReaxFF 力场训练集构建与评估**
- **Gaussian / VASP 等量化计算的任务自动化与结果解析**
- **结构可视化与轨迹分析（含自由基统计、扫描任务等）**
- **基于主动学习（Active Learning）的训练集增量采样**

它以 **Tkinter 桌面 GUI + 内嵌 Py3Dmol 3D 结构视窗 + 本地 HTML 组件** 为基础，为“从几何结构 → 量化计算 → 训练集文件 → 力场评估/再采样”的完整闭环提供一站式解决方案。

---

## 📦 安装与运行

1. 在 https://github.com/child112/TSGen/releases 下载最新的安装包。 
2. 解压到非中文且不含空格的路径（例如 `D:\TSGen\`）。  
3. 双击 `TSGen.exe` 即可启动。  
4. 无需本地 Python 环境和第三方库。

## 🧩 功能总览（与主界面对应）

TSGen 主界面按照功能被划分为以下几个区域（见软件左侧按钮分组）：

### 1. 文件与配置

- **选择输出文件**  
  指定当前工程的输出路径，用于保存摘要、统计结果及中间文件。

- **加载扫描配置 / 清空扫描配置**  
  - 从配置文件中加载已经定义好的扫描任务（键长扫描、键角扫描、二面角扫描等），自动关联到后续的 GEO 生成与 Gaussian 任务构建。  
  - 一键清除当前扫描设置，便于重新配置新体系。

- 顶部工具栏：  
  - **导出摘要**：导出当前项目的计算概述与关键信息（如结构数量、能量范围、训练集条目统计等）。  
  - **导出计算数据**：批量导出结构能量、几何参数、频率等数值数据，便于后续在 Python / Origin / Excel 中进行二次分析。  
  - **VASP 收敛图…**：从 VASP 输出中自动提取能量、残差随迭代步变化，生成收敛曲线图（支持批量、多任务对比）。  
  - **清空日志**：清除当前会话的运行日志，便于新一轮调试或记录。

---

### 2. 可视化与分析

- **结构预处理**  
  - 读取 Gaussian `.log / .out`、`.gjf`、标准 `.xyz`、`.pdb`、ReaxFF `.geo` 等文件。  
  - 自动识别分子碎片、关键键、键角、二面角信息。  
  - 为后续扫描任务、训练集生成和自由基统计做好结构准备。

- **计算分析**  
  主要面向 **MD / ReaxFF 轨迹与结构集** 的分析，包括：  
  - 基于 XYZ 轨迹的 **自由基数量随时间演化统计**：  
    - 支持用户指定物种（例如·OH、·HO₂、·CH₃、O₂、H₂O₂ 等），自动识别并统计每一帧的分子数。  
    - 区分 **from H₂O** 与 **non-H₂O** 源的自由基（基于第一帧残基归属并在后续帧保持标签）。  
    - 支持多段轨迹文件自动拼接，并在曲线中消除文件间断点。  
  - 其他动力学相关分析（如物种浓度变化、结构数量统计等）。  
  - 输出内容包括：  
    - 曲线图（PNG）  
    - 结构/物种随时间变化表格（CSV）

- **结构高级处理**  
  - 面向复杂反应路径与催化体系的结构操作：  
    - 关键中间体筛选与标记  
    - 针对特定键 / 角 / 二面角的扫描点自动生成  
    - 重构适合 ReaxFF 训练或 DFT 精修的结构子集  
  - 为 “Trainset.in 生成器” 和 “GEO 生成器” 提供更高层次的上游数据预整理。

---

### 3. 计算任务自动管理

- **计算任务构建器**  
  - 通过图形化方式配置 Gaussian / VASP 等计算任务模板：  
    - 功能类型（优化、频率、扫描、TS 搜索等）  
    - 理论级别、基组、SCF 选项等  
    - 并行设置（如 NProc、内存等）  
  - 支持对不同体系应用统一的任务模板。

- **计算任务生成器**  
  - 将上游结构集（来自“结构预处理 / 高级处理 / GEO 生成器”）批量映射到任务模板上，生成：  
    - Gaussian `.gjf` 输入文件  
    - VASP 输入文件（如 INCAR/ POSCAR / KPOINTS / POTCAR 组合）  
  - 支持按体系/反应路径命名规则自动命名文件与目录。

- **计算任务管理器**  
  - 用于组织已有任务的输出结果（例如大批量 Gaussian log 或 VASP 结果）：  
    - 自动检查任务是否收敛、是否存在错误终止。  
    - 将成功任务自动纳入后续训练集或分析模块。  
    - 将失败任务汇总导出，便于重新检查或调整参数重跑。

---

### 4. 训练集文件生成

- **Trainset.in 生成器**  
  - 面向 ReaxFF 力场开发的核心模块之一：  
    - 支持从 Gaussian / VASP / 其他量化结果中自动汇总 **ENERGY / GEOMETRY / BOND / ANGLE / DIHEDRAL** 等条目。  
    - 按反应类别、构型类型、温度区间等标签对数据进行分组管理。  
    - 根据用户设定权重生成标准格式的 `trainset.in` 文件。  
  - 目标是最大程度减少手工编辑 trainset.in 所带来的出错风险。

- **GEO 生成器**  
  - 适配 ReaxFF/MD 模拟的几何输入生成工具：  
    - 支持从现有结构（XYZ / GJF / LOG 最后一帧等）自动生成 `.geo` 文件。  
    - 提供 **智能约束生成功能**：  
      - 根据化学环境识别关键键（如裂解键、迁移氢键、酸性位点附近键等）和重要角度。  
      - 自动构建 BOND / ANGLE /（可选 DIHEDRAL）约束段，并组合为完整的 `BIOGRF ... END` 结构块。  
    - 支持扫描任务：  
      - 键长扫描（例如 1.0–5.0 Å）  
      - 键角扫描（例如 70°–140°）  
      - 二面角扫描  
    - 可以针对一组结构仅保留“物理上最关键的一组约束”，避免约束过多导致拟合或动力学不合理。

---

### 5. 训练集智能评估与采样（Active Learning）

- **训练集智能评估**  
  - 对给定 ReaxFF 参数集与 trainset 进行：  
    - 误差统计（MAE / RMSE / 最大偏差等）  
    - 不同子集（例如：平衡结构、过渡态、高温裂解片段、催化吸附态等）的误差拆分  
    - 识别高误差样本，为后续主动学习提供候选点。  

- **主动学习自动采样**  
  - 面向“短程 AIMD + ReaxFF 模型增强模拟”等工作流：  
    - 从 MD / AIMD 轨迹中自动筛选“信息量高”的结构（如反应过渡构型、稀有路径、高不确定性区间）。  
    - 生成相应的 Gaussian / VASP 任务输入，加入下一轮高精度计算与训练集更新。  
  - 该模块目前处于持续迭代阶段，适合作为研究型工作流的实验平台。

---

## 🔍 典型工作流示例

### 工作流 1：ReaxFF 力场开发

1. 在 **结构预处理** 中导入来自高温 ReaxFF-MD 或 AIMD 的轨迹/快照。  
2. 使用 **结构高级处理**，筛选关键中间体、过渡态近似结构和代表性构型。  
3. 通过 **计算任务构建器 / 生成器** 批量生成 Gaussian 或 VASP 精修任务。  
4. 量化计算结束后，用 **计算任务管理器** 检查并整理结果。  
5. 在 **Trainset.in 生成器** 中合并能量、几何及约束信息，生成或更新 `trainset.in`。  
6. 使用 **训练集智能评估** 评估当前力场精度，并在需要时调用 **主动学习自动采样** 来选择增量样本。

### 工作流 2：Gaussian 键扫描 + GEO 扫描结构生成

1. 先在 **结构预处理** 中指定基态或反应前体结构。  
2. 在 **结构高级处理 / GEO 生成器** 中定义扫描的键 / 角 / 二面角及其范围。  
3. 自动生成一系列扫描构型（`.gjf` + `.geo`），并通过 **计算任务生成器** 提交。  
4. 解析 log 后，用 **可视化与分析** 模块查看能量曲线、结构演化与关键几何变化。

### 工作流 3：ReaxFF-MD 自由基时间演化统计

1. 在 **结构预处理** 中导入大体积 XYZ 轨迹文件（支持 GB 级别）。  
2. 在 **计算分析** 中指定需要统计的自由基种类，并设定判断阈值。  
3. 启动分析：  
   - 程序采用流式读取与碎片识别，自动标记 from H₂O / non-H₂O 源；  
   - 输出总自由基、分来源自由基数量随时间的曲线和数据表。  
4. 结果可直接用于撰写裂解/氧化机理分析章节或绘图。

### 工作流 4：VASP 收敛性与结果概览

1. 将多个 VASP 计算目录导入 TSGen。  
2. 通过 **VASP 收敛图…** 生成能量、残差随电子步/离子步的收敛曲线。  
3. 利用 **导出摘要 / 导出计算数据** 汇总不同体系的关键参数，便于对比不同功能、U 值、掺杂配置等。
4. 利用 **计算分析** 中第一性原理分析页，进行DOS核能带分析，上传计算结果一键得到能带与DOS的图和数据。
---

## ⚡ 常见问题 FAQ

- **双击没反应 / 闪退**  
  请确认 `tsgen/web/assets/` 文件夹未丢失。  

- **结构预处理打开网页显示空白**  
  说明本地 HTML 资源缺失或安全软件阻止本地文件加载，可暂时关闭防火墙/安全软件，同时使用 TSGen最新版本（完全修复 PyInstaller 的资源路径问题）
  
- **输出文件解析失败**  
  通常是缺少 “Normal termination”，任务未正常结束或输出文件被截断或计算中断，请检查任务是否正常结束
  对于Gaussian计算作业，建议使用 G16 或 G09 D.01版本

- **加载大型 XYZ 轨迹（>3 GB）时卡顿或失败**  
  对于AMS产生的ASCII文件，可使用**计算分析**中的**大轨迹文件预处理**功能，选取主要分析的时间段进行分析。
  同时对大型轨迹文件建议预先进行分段处理，或使用更好性能的硬件配置。






